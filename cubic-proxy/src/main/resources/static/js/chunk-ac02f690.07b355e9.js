(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac02f690"],{"62d8":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",{staticStyle:{"font-size":"14px"}},[t._v("应用： ")]),n("el-select",{staticClass:"mr",staticStyle:{width:"280px"},attrs:{size:"mini",filterable:"",placeholder:"请选择应用"},on:{change:t.appChange},model:{value:t.instanceName,callback:function(e){t.instanceName=e},expression:"instanceName"}},t._l(t.appOption,(function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})})),1),n("span",{staticStyle:{"font-size":"14px"}},[t._v("实例： ")]),n("el-select",{staticStyle:{width:"280px"},attrs:{size:"mini",placeholder:"请选择应用实例"},on:{change:t.instanceUidChange},model:{value:t.instanceUid,callback:function(e){t.instanceUid=e},expression:"instanceUid"}},t._l(t.instanceUidOption,(function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),n("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("div",{staticClass:"xterm",attrs:{id:"xterm"}})])],1)],1)},i=[],o=(n("e9c4"),n("8a79"),n("1e25"),n("d3b7"),n("25f0"),n("fcf3")),a=n("47d0"),c=n("408b"),r=(n("abb2"),n("62e4")),l={name:"WebShell",data:function(){return{activeName:"1",instanceUidOption:[],instanceUid:"",instanceName:"",appOption:[],vm:{ip:"localhost",port:11901,agentId:"cubic"},socket:null,term:null,result:"",currType:"3",state:"",type:[1,3],msg:{1:{text:"进入自定义命令模式 "},3:{text:"进入 arthas命令模式 "}},rows:400,cols:100}},created:function(){this.instanceUid=this.$cookies.get("appId"),this.instanceName=this.$cookies.get("instanceName"),this.vm.agentId=this.$cookies.get("appId"),this.getClientNames(),this.getInstanceList({name:this.instanceName}),console.log(this.$cookies.get("appId"))},mounted:function(){this.vm.ip=this.$cookies.get("serverIp"),this.startConnect(),this.interval()},methods:{initXterm:function(){this.rows=document.querySelector(".app-container").offsetHeight,this.cols=document.querySelector(".app-container").offsetWidth;var t=this;this.term=new o["Terminal"]({cursorBlink:!0,rows:parseInt(t.rows),cols:parseInt(t.cols),cursorStyle:"block",screenKeys:!0,theme:{foreground:"#7e9192",background:"#002833",cursor:"help",lineHeight:16}});var e=new a["FitAddon"];this.term.loadAddon(e),this.term.loadAddon(new c["WebLinksAddon"]),this.term.open(document.getElementById("xterm")),e.fit(),this.socket=new WebSocket("ws://"+this.vm.ip+":"+this.vm.port+"/ws"),this.term.focus(),this.term.writeln(" "),this.term.writeln(" > 欢迎进入Arthas代理终端，此终端可连接到目标机器进行命令操作"),this.term.writeln(""),this.term.writeln(" > Arthas 命令请查看文档 https://alibaba.github.io/arthas/commands.html"),this.term.writeln(""),this.term.writeln(" > 正在连接。。。"),this.term.writeln("")},resizeScreen:function(t){console.log("size",t);try{this.fitAddon.fit();var e=this;this.term.onResize((function(t){e.sendMessage(e.agentId,{Op:"resize",Cols:t.cols,Rows:t.rows})}))}catch(n){console.log("e",n.message)}},prompt:function(){this.term.write("\r\n$ ")},sendMessage:function(t,e){"clear"!==e?null!=this.socket&&this.socket.send(JSON.stringify({instanceUuid:this.vm.agentId,type:this.currType,command:e})):this.term.clear()},switchState:function(t){return"1"!==t&&"3"!==t||(this.currType=t,this.prompt(),this.term.write(this.msg[t].text+"\r\n"),this.result="",!1)},socketOnMessage:function(){var t=this;this.socket.onmessage=function(e){if(console.log(e),"message"===e.type){var n=e.data;t.term.write(n),n.toString().trimEnd().endsWith("$")||3===t.currType||t.prompt()}}},termOnKey:function(){var t=this;console.log(this.term),this.term.onKey((function(e){var n=!e.domEvent.altKey&&!e.domEvent.ctrlKey;if("Enter"===e.domEvent.code){var s=t.switchState(t.result);s&&(t.sendMessage(t.vm.agentId,t.result),t.result=""),t.prompt()}else"Backspace"===e.domEvent.code?t.term._core.buffer.x>2&&(t.result=t.result.substring(0,t.result.length-1),t.term.write("\b \b")):n&&(t.term.write(e.key),t.result+=e.key)}))},socketOnOpen:function(){var t=this;this.socket.onopen=function(){t.term.writeln(" > 已连接, 当前 IP : "+t.vm.ip+", ID: "+t.vm.agentId),t.prompt(),t.termOnKey(),t.socketOnMessage();var e=t;document.addEventListener("paste",(function(t){var n=t.clipboardData.getData("text/plain");e.term.write(n),e.result+=n,t.stopPropagation()}))}},socketOnClose:function(){var t=this;this.socket.onclose=function(){null!=t.term&&(t.term.writeln(" websocket channel close, please reconnect!"),t.prompt())}},socketOnError:function(){var t=this;this.socket.onerror=function(){t.socket=null,t.term.writeln(" websocket channel error ,will close this,please reconnect!"),t.prompt()}},disconnect:function(){try{null!=this.socket&&(this.socket.send(JSON.stringify({instanceUuid:this.vm.agentId,type:999,command:this.result})),this.socket.close(),this.socket=null,console.log("closed ws succ!")),null!=this.term&&(this.term.dispose(),console.log("dispose xterm succ!")),console.log("Connection was closed successfully!")}catch(t){console.log("No connection, please start connect first.")}},startConnect:function(){this.disconnect(),this.initXterm(),this.socketOnClose(),this.socketOnOpen(),this.socketOnError()},getAppInfo:function(){var t=this;Object(r["a"])().then((function(e){console.log(e.data),t.vm.ip=e.data.serverIp})),this.getInstanceList()},getClientNames:function(){var t=this;Object(r["b"])().then((function(e){console.log(e.data),t.appOption=e.data,""!==t.instanceName||(t.instanceName=e.data[0])})),this.getInstanceList()},getInstanceList:function(t){var e=this;Object(r["d"])(t).then((function(t){e.instanceUidOption=t.data,e.instanceUid=t.data[0]}))},appChange:function(t){this.instanceName=t,this.instanceUid="",this.$cookies.set("instanceName",t),this.$cookies.set("instanceUid",""),this.getInstanceList({name:this.instanceName})},instanceUidChange:function(t){this.$cookies.set("instanceUid",t)},interval:function(){var t=this;window.setInterval((function(){null!==t.socket&&t.socket.send(JSON.stringify({instanceUuid:t.vm.agentId,type:0,command:1}))}),5e3)}}},u=l,h=(n("c603"),n("2877")),m=Object(h["a"])(u,s,i,!1,null,"0e22cf9d",null);e["default"]=m.exports},"62e4":function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return l}));var s=n("b775");function i(t){return Object(s["a"])({url:"/app/getList",method:"get",params:t})}function o(t){return Object(s["a"])({url:"/jvm/threadPoolList",method:"get",params:t})}function a(t){return Object(s["a"])({url:"/jar/getList",method:"get",params:t})}function c(t){return Object(s["a"])({url:"/app/getInstanceInfo",method:"get",params:t})}function r(t){return Object(s["a"])({url:"/app/getInstanceNames",method:"get",params:t})}function l(){return Object(s["a"])({url:"/app/getAppNames",method:"get"})}},b573:function(t,e,n){},c603:function(t,e,n){"use strict";n("b573")}}]);
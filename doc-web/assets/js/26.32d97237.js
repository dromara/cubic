(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{353:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"产生问题的原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产生问题的原因"}},[s._v("#")]),s._v(" 产生问题的原因")]),s._v(" "),a("p",[s._v("JDK17 发布后，很多项目都出现了兼容性问题，包括我们项目")]),s._v(" "),a("h2",{attrs:{id:"产生问题原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产生问题原因"}},[s._v("#")]),s._v(" 产生问题原因")]),s._v(" "),a("p",[s._v("问题代码")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * return accessible accessibleObject\n   *\n   * @param accessibleObject accessibleObject method\n   * @param <$ACCESSIBLE_OBJECT> a $ACCESSIBLE_OBJECT class\n   * @return accessibleObject\n   */")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACCESSIBLE_OBJECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AccessibleObject")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ACCESSIBLE_OBJECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("accessible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      $"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ACCESSIBLE_OBJECT")]),s._v(" accessibleObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("accessibleObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAccessible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" accessibleObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AccessController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("doPrivileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PrivilegedAction")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACCESSIBLE_OBJECT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              accessibleObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAccessible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" accessibleObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("上述是源代码，然后产生的问题是")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("java.lang.reflect.InaccessibleObjectException: Unable to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" field private static final long java.lang.invoke.MethodType.serialVersionUID accessible: module java.base does not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"opens java.lang.invoke"')]),s._v(" to unnamed module @6cc4c815\n")])])]),a("blockquote",[a("p",[s._v("在stream-query中到处充斥着反射调用，在JDK17中，反射调用被严格限制，所以导致项目在JDK17中运行报错\n是因为在jkd9版本及以上版本中，Java平台模块化系统（JPMS）引入了更严格的访问控制。\n即使通过反射API调用setAccessible(true)试图强制访问某个类的私有成员，\n如果包含该成员的模块没有显式地向调用者模块开放(opens)相应的包，那么尝试访问该成员时将会抛出异常。")])]),s._v(" "),a("h2",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),a("p",[s._v("我们这里做了善意的提示，如果你使用的是JDK17，那么你在调用此方法时会将异常捕获提示用户如何操作\n而JDK8版本则不会有任何提示，不会影响任何使用")]),s._v(" "),a("p",[s._v("在jvm参数中添加以下参数即可解决问题")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("--add-opens java.base/java.util"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ALL-UNNAMED --add-opens java.base/java.lang"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ALL-UNNAMED --add-opens java.base/java.lang.invoke"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ALL-UNNAMED\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);